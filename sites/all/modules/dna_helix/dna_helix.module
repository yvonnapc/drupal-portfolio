<?php

function dna_helix_menu(){
  $items['dna_helix'] = array(
    'title' => 'DNA Helix',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('dna_helix_form'),
    'access callback' => TRUE,
    'type' => MENU_NORMAL_ITEM,
  );
  $items['dna_helix_success'] = array(
    'title' => 'DNA Helix Success',
    'page callback' => 'dna_helix_results',
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );
  return $items;
}

function dna_helix_form(){
  $form['input'] = array(
      '#title' => 'Helix',
      '#description' => 'Enter the first sequence of elements in your DNA',
      '#type' => 'textfield',
      '#element_validate' => array('element_validate_helix'),
      '#required' => TRUE,
  );
  $form['submit'] = array(
      '#type' => 'submit',
      '#value' => 'Submit',
  );
  return $form;
}

function element_validate_helix($element){
  $user_input = str_split(strtoupper($element['#value']));
  $nucleotides = array('A', 'T', 'C', 'G');

  foreach($user_input as $letter){
    if(!in_array($letter, $nucleotides)){
      form_error($element, t('Please enter only A, T, C, G'));
    }
  }
}

function dna_helix_form_submit($form, &$form_state){
  $input = $form_state['values']['input'];
  $split_input = str_split(strtoupper($input));
  $_SESSION['input'] = $input;
  $output = '';

  foreach($split_input as $letter){
    if($letter === 'T'){
      $output .'A';
    } elseif ($letter === 'A'){
      $output .'T';
    }elseif($letter === 'C'){
      $output .'G';
    }elseif($letter === 'G'){
      $output .'C';
    }
  }

  $original_phrase = $_SESSION['input'];
  $_SESSION['new_dna'] = $output;
  $form_state['redirect'] = 'dna_helix_success';
}

function dna_helix_results(){
  $original_phrase = $_SESSION['input'];

  return '<h1>Your first set of helix:</h1>' . $original_phrase .
         '<h1>Your second set of helix:</h1>' . $_SESSION['new_dna'];
}
